webpackJsonp([5],{"8PSA":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("Dd8w"),n=i.n(a),l=i("GwN5"),o=i.n(l),s=i("NYxO"),r={created:function(){this.getActivityList()},computed:n()({},Object(s.b)({activityList:"activityList",attachFiles:"attachFiles"}),{disableDeleteConfirm:function(){return!this.deleteReason},disableSearchConfirm:function(){return!(this.search.condition&&this.search.keyword)}}),methods:{handleSortChange:function(e){e.order&&this.getActivityList(1,20,e.prop,"ascending"===e.order?"asc":"desc")},getActivityStatus:function(e){return e.delete_time?{status:"删除",tag:"danger"}:e.private?{status:"隐藏",tag:"warning"}:{status:"公开",tag:"success"}},getActivityList:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"post_time",a=this,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"DESC",l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"all";this.listLoading=!0,this.$store.dispatch("SquareManage/activityList",{page:e,limit:t,sort_condition:i,sort_type:n,status:l}).then(function(e){console.log(e.msg),a.listLoading=!1}).catch(function(e){console.log(e),a.listLoading=!1})},getFile:function(e,t,i,a){return this.$store.dispatch("SquareManage/getFile",{url:e,fetchType:t,activityId:i,fileId:a})},handleGetThumbs:function(e,t){var i=this;this.image.thumb.length=0;var a=function(a){i.getFile(e[a].small,"small",t,a).then(function(e){var t={id:a,src:e};i.image.thumb.push(t)})};for(var n in e)a(n)},handleFullscreenImage:function(e,t){var i=this;for(var a in this.image.large.length=0,this.fullscreenImageVisible=!0,e)this.getFile(e[a].large,"large",t,a).then(function(e){i.image.large.push(e)})},handlePlayVideo:function(e,t,i){var a=this;this.video.src="",this.video.poster=this.attachFiles.small[t][i],this.videoVisible=!0,this.getFile(e[i].large,"large",t,i).then(function(e){a.video.src=e})},deleteDialog:function(e){this.tableIndex=e,this.showDeleteDialog=!0},handleDeleteConfirm:function(){var e=this;this.disableFreezeConfirm||this.$confirm("此操作将删除该动态内容,附件内容,及其评论信息,此操作无法撤回,是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.deleteLoading=!0,e.$store.dispatch("SquareManage/deleteActivity",{tableIndex:e.tableIndex,activityId:e.activityList.list[e.tableIndex].id,deleteReason:e.deleteReason}).then(function(t){e.deleteLoading=!1,e.showDeleteDialog=!1,e.deleteReason=void 0,e.$message({message:t.msg,type:"success"})}).catch(function(){e.deleteLoading=!1,e.showDeleteDialog=!1})}).catch(function(){e.$message({message:"操作已取消",type:"info"})})},filterStatus:function(e,t,i){return this.getActivityStatus(t).status===e},handleChangeSearchCondition:function(e){this.search.condition=e},handleSearch:function(){var e=this;this.listLoading=!0,this.$store.dispatch("CommunityManage/searchActivity",this.search).then(function(t){console.log(t.msg),e.listLoading=!1}).catch(function(t){console.log(t),e.listLoading=!1})}},data:function(){return{video:{src:"",poster:""},image:{thumb:[],large:[]},search:{condition:"content",keyword:void 0},images:{},tableIndex:void 0,deleteReason:void 0,Consts:o.a,showDeleteDialog:!1,showSearchDialog:!1,deleteLoading:!1,searchLoading:!1,listLoading:!0,fullscreenImageVisible:!1,videoVisible:!1}}},c={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-dialog",{attrs:{title:"删帖",visible:e.showDeleteDialog,width:"250px",center:!0},on:{"update:visible":function(t){e.showDeleteDialog=t}}},[i("el-select",{attrs:{placeholder:"请选择动态删除理由"},model:{value:e.deleteReason,callback:function(t){e.deleteReason=t},expression:"deleteReason"}},e._l(e.Consts.deleteReasons,function(e,t){return i("el-option",{key:t,attrs:{label:e,value:t}})}),1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.showDeleteDialog=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{loading:e.deleteLoading,type:"primary",disabled:e.disableDeleteConfirm},on:{click:e.handleDeleteConfirm}},[e._v("确 定")])],1)],1),e._v(" "),i("ImagePreview",{attrs:{path:e.image.large,isVisible:e.fullscreenImageVisible},on:{"update:isVisible":function(t){e.fullscreenImageVisible=t},"update:is-visible":function(t){e.fullscreenImageVisible=t}}}),e._v(" "),e.videoVisible?i("div",{staticStyle:{display:"flex",width:"90%",height:"80%","z-index":"100","align-items":"center",position:"absolute"},on:{click:function(t){if(t.target!==t.currentTarget)return null;e.videoVisible=!1}}},[i("video",{staticStyle:{margin:"auto"},attrs:{controls:"",src:e.video.src,poster:e.video.poster}})]):e._e(),e._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:e.activityList.list,stripe:"","tooltip-effect":"dark"},on:{"sort-change":e.handleSortChange}},[i("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[i("el-form-item",{attrs:{label:"附件"}},[t.row.attach_files.image_count>0?i("el-popover",{attrs:{placement:"bottom",trigger:"hover"}},[e._l(e.image.thumb,function(e,t){return i("div",{key:t,staticStyle:{display:"inline"}},[i("el-image",{staticStyle:{cursor:"pointer"},attrs:{src:e.src,fit:"fill"}})],1)}),e._v(" "),i("el-tag",{staticStyle:{cursor:"pointer"},attrs:{slot:"reference",type:"success"},on:{click:function(i){return e.handleFullscreenImage(t.row.attach_files.images_list,t.row.id)}},nativeOn:{mouseenter:function(i){return e.handleGetThumbs(t.row.attach_files.images_list,t.row.id)}},slot:"reference"},[e._v(e._s("图片:"+t.row.attach_files.image_count))])],2):e._e(),e._v(" "),t.row.attach_files.video_count>0?i("el-popover",{attrs:{placement:"right",trigger:"hover"}},[e._l(e.image.thumb,function(a,n){return i("div",{key:n,staticStyle:{display:"inline"}},[i("el-image",{staticStyle:{cursor:"pointer"},attrs:{src:a.src,fit:"fill"},on:{click:function(i){return e.handlePlayVideo(t.row.attach_files.videos_list,t.row.id,a.id)}}})],1)}),e._v(" "),i("el-tag",{staticStyle:{cursor:"pointer"},attrs:{slot:"reference",type:"success"},nativeOn:{mouseenter:function(i){return e.handleGetThumbs(t.row.attach_files.videos_list,t.row.id)}},slot:"reference"},[e._v(e._s("视频:"+t.row.attach_files.video_count))])],2):e._e()],1),e._v(" "),t.row.delete_time?i("el-form-item",{attrs:{label:"删除时间"}},[i("span",[e._v(e._s(t.row.delete_time))])]):e._e(),e._v(" "),t.row.delete_time?i("el-form-item",{attrs:{label:"删除原因"}},[i("span",[e._v(e._s(t.row.delete_reason))])]):e._e()],1)]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"ID",prop:"id"}}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"内容",prop:"content","show-overflow-tooltip":""}}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"发布者",prop:"user.username"}}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"发布时间",prop:"post_time",sortable:"custom"}}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"最近评论",prop:"last_comment_time",sortable:"custom"}}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"点赞数量",prop:"like_count",sortable:"custom"}}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"评论数量",prop:"comment_count",sortable:"custom"}}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"分享数量",prop:"share_count",sortable:"custom"}}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"状态",filters:[{text:"公开",value:"公开"},{text:"隐藏",value:"隐藏"},{text:"删除",value:"删除"}],"filter-method":e.filterStatus},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-tag",{attrs:{type:e.getActivityStatus(t.row).tag}},[e._v(e._s(e.getActivityStatus(t.row).status))])]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"right"},scopedSlots:e._u([{key:"header",fn:function(t){return[i("el-input",{attrs:{placeholder:"请输入关键词"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch(t)}},model:{value:e.search.keyword,callback:function(t){e.$set(e.search,"keyword",t)},expression:"search.keyword"}},[i("el-dropdown",{attrs:{slot:"prefix"},on:{command:e.handleChangeSearchCondition},slot:"prefix"},[i("i",{staticClass:"el-input__icon el-icon-search"}),e._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",{attrs:{disabled:"content"===e.search.condition,command:"content"}},[e._v("内容")]),e._v(" "),i("el-dropdown-item",{attrs:{disabled:"publisher"===e.search.condition,command:"publisher"}},[e._v("发布者")])],1)],1)],1)]}},{key:"default",fn:function(t){return[i("el-button",{attrs:{size:"mini",type:"warning",loading:e.deleteLoading,disabled:!!t.row.delete_time},on:{click:function(i){return e.deleteDialog(t.$index)}}},[e._v("删除")])]}}])}),e._v(" "),i("div",{staticStyle:{display:"flex"},attrs:{slot:"append"},slot:"append"},[i("el-pagination",{staticStyle:{margin:"auto"},attrs:{"hide-on-single-page":"",background:"",layout:"prev, pager, next","page-size":e.activityList.limit,"page-count":e.activityList.total_page,"current-page":e.activityList.page},on:{"current-change":e.getActivityList}})],1)],1)],1)},staticRenderFns:[]};var d=i("VU/8")(r,c,!1,function(e){i("xmtb")},null,null);t.default=d.exports},xmtb:function(e,t){}});
//# sourceMappingURL=5.ac32d8678852025d1a82.js.map